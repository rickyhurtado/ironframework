// sse.library.min.js v1.0
I.Library.SSE={url:{},sseObj:{},startSseObj:{},sseObjExpire:{},sseObjRestart:[],ajax:{},refresh:{},expiration:{},restart:{},success:{},error:{},expire:{},init:function(a){this.url[a.id]=a.url;this.ajax[a.id]=a.ajax?a.ajax:!1;this.refresh[a.id]=a.refresh?a.refresh:30;this.expiration[a.id]=a.expiration?a.expiration:!1;this.success[a.id]=a.success;this.error[a.id]=a.error;this.expire[a.id]=a.expire;this.restart[a.id]=a.restart?a.restart:!0;this.sseObjExpire[a.id]=0;this.bindEvents();this.start(a.id)}, bindEvents:function(){var a=this,b=!0;$(document).on("mousemove keyup","body",function(){0<a.sseObjRestart.length&&(_.map(a.sseObjRestart,function(b){a.restart[b]&&a.start(b)}),a.sseObjRestart=[]);b&&(b=!1,_.map(a.sseObjExpire,function(b,d){clearTimeout(a.sseObjExpire[d]);a.sseObjExpire[d]=0;a.setExpiration(d)}),b=!0)})},start:function(a){var b=this;void 0==typeof EventSource&&(b.ajax[a]=!0);null==a||b.ajax[a]?(console.log("["+a+"] SSE (AJAX) session has been started."),b.startAJAX(a)):(b.sseObj[a]= new EventSource(b.url[a]),console.log("["+a+"] SSE session has been started."),b.sseObj[a].onerror=function(){if(2==b.sseObj[a].readyState)b.error[a]()},b.sseObj[a].onmessage=function(c){c=JSON.parse(c.data);console.log("[SSE] ID: "+a);console.log("[SSE] URL: "+b.url[a]);b.success[a](c)});b.setExpiration(a)},startAJAX:function(a){var b=this;b.sseObj[a]=Backbone.ajax({url:b.url[a],type:"post",dataType:"json",cache:!1,success:function(c){b.startSseObj[a]=setTimeout(function(){console.log("[SSE AJAX] ID: "+ a);b.startAJAX(a)},1E3*b.refresh[a]);b.success[a](c)},error:function(){b.error[a]}})},setExpiration:function(a){var b=this;0==b.sseObjExpire[a]&&b.expiration[a]&&(b.sseObjExpire[a]=setTimeout(function(){b.abort(a);b.expire[a]()},1E3*b.expiration[a]))},abort:function(a){this.ajax[a]?(clearTimeout(this.startSseObj[a]),this.sseObj[a].abort(),console.log("["+a+"] SSE (AJAX) session has been stopped.")):(this.sseObj[a].close(),console.log("["+a+"] SSE session has been stopped."));clearTimeout(this.sseObjExpire[a]); this.sseObjExpire[a]=0;0>_.indexOf(this.sseObjRestart,a)&&this.sseObjRestart.push(a)},reset:function(a){this.abort(a);$("body").trigger("keyup");console.log("["+a+"] SSE session has been reset.")}};